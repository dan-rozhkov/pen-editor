=== 2026-01-24 | Инициализация проекта ===

Статус: Проект инициализирован

Выполнено:
- Создан feature_list.json с 17 фичами в 4 фазах
- Создан claude-progress.txt

Следующие шаги:
- Настройка Vite + React + TypeScript + Zustand
- Реализация базового canvas с Konva.js

---

=== 2026-01-24 | Feature 1: Настройка Vite + React + TypeScript + Zustand ===

Статус: PASSED ✓

Выполнено:
- Создан Vite проект с шаблоном react-ts
- Установлены зависимости: react, zustand, konva, react-konva
- TypeScript конфигурация с strict: true
- Dev server запускается на localhost:5173
- E2E тест пройден: страница загружается, React работает (кнопка-счётчик)

Следующие шаги:
- Konva.js canvas с viewport (pan/zoom)

---

=== 2026-01-24 | Feature 2: Konva.js canvas с viewport (pan/zoom) ===

Статус: PASSED ✓

Выполнено:
- Создан Zustand store для viewport state (scale, x, y, isPanning)
- Создан Canvas компонент с Konva Stage и Layer
- Реализован zoom колёсиком мыши с центрированием на курсоре
- Реализован pan зажатием middle mouse button
- Реализован pan зажатием пробела + drag
- Добавлены демо-фигуры (Rect, Circle) для визуализации
- Исправлена проблема с несколькими копиями React (vite.config.ts alias)
- E2E тест пройден: zoom и pan работают корректно

Следующие шаги:
- Scene Graph с примитивами (frame, rect, ellipse, text)

---

=== 2026-01-24 | Feature 3: Scene Graph с примитивами (frame, rect, ellipse, text) ===

Статус: PASSED ✓

Выполнено:
- Созданы TypeScript типы для узлов Scene Graph (src/types/scene.ts)
- Создан Zustand store для управления узлами (src/store/sceneStore.ts)
- Создан RenderNode компонент для рекурсивного рендеринга узлов
- Создан Toolbar компонент с кнопками для создания примитивов
- Обновлён Canvas.tsx для динамического рендеринга из store
- Обновлён App.tsx с layout (Toolbar слева, Canvas справа)
- E2E тест пройден: все 4 примитива создаются и отображаются на canvas

Следующие шаги:
- Selection & Transform (move, resize)

---

=== 2026-01-24 | Feature 4: Selection & Transform (move, resize) ===

Статус: PASSED ✓

Выполнено:
- Создан Zustand store для selection state (src/store/selectionStore.ts)
- Добавлен Konva Transformer компонент для bounding box и resize handles
- Реализован клик на элемент для выделения
- Реализован Shift+клик для множественного выделения
- Реализован drag для перемещения элементов
- Реализован resize через Transformer handles
- Клик на пустое место снимает выделение
- E2E тест пройден: все функции работают корректно

Следующие шаги:
- Layers Panel (иерархия узлов)

---

=== 2026-01-24 | Feature 5: Layers Panel (иерархия узлов) ===

Статус: PASSED ✓

Выполнено:
- Добавлены поля visible и name в BaseNode type (src/types/scene.ts)
- Добавлены методы reorderNode, setVisibility, toggleVisibility в sceneStore
- Создан компонент LayersPanel (src/components/LayersPanel.tsx)
- Реализована панель справа с списком слоёв
- Иконки для каждого типа узла (frame, rect, ellipse, text)
- Клик на слой выделяет его на canvas
- Shift+клик для множественного выделения
- Drag-n-drop для изменения порядка слоёв
- Кнопка visibility (глаз) для скрытия/показа узлов
- Скрытые узлы не рендерятся на canvas (RenderNode проверяет visible)
- E2E тест пройден через Puppeteer: все функции работают

Следующие шаги:
- Properties Panel (редактирование свойств)

---

=== 2026-01-24 | Feature 6: Properties Panel (редактирование свойств) ===

Статус: PASSED ✓

Выполнено:
- Создан компонент PropertyInputs.tsx с переиспользуемыми инпутами (NumberInput, ColorInput, TextInput)
- Создан компонент PropertiesPanel.tsx с секциями Position, Size, Fill, Stroke, Corner Radius
- Создан компонент RightSidebar.tsx как контейнер для LayersPanel + PropertiesPanel
- Модифицирован LayersPanel.tsx для stacked layout (h-[280px], убран border-l)
- Обновлён App.tsx для использования RightSidebar
- Панель показывает "Select a layer" при отсутствии выделения
- Панель показывает "X layers selected" при множественном выделении
- Для text узлов добавлены секции Text и Font (fontSize, fontFamily)
- Real-time обновления через updateNode() в Zustand store
- E2E тест пройден: позиция, размер, цвета изменяются и отображаются на canvas

Следующие шаги:
- Сохранение/загрузка JSON файлов

---

=== 2026-01-24 | Feature 7: Сохранение/загрузка JSON файлов ===

Статус: PASSED ✓

Выполнено:
- Добавлен метод setNodes в sceneStore для загрузки документов
- Создан src/utils/fileUtils.ts с функциями сериализации/десериализации
- Добавлены кнопки Save и Open в Toolbar
- Формат документа: { version: "1.0", nodes: [...] }
- E2E тест пройден: создание узлов → Save → перезагрузка → Open → узлы восстановлены

Следующие шаги:
- Интеграция yoga-layout (WASM) для auto-layout

---

=== 2026-01-24 | Feature 8: Интеграция yoga-layout (WASM) ===

Статус: PASSED ✓

Выполнено:
- Установлен npm пакет yoga-layout (WASM версия)
- Создан src/utils/yogaLayout.ts с функциями инициализации и расчёта layout
- Создан src/store/layoutStore.ts для управления состоянием yoga
- Добавлены типы LayoutProperties (flexDirection, gap, padding, alignItems, justifyContent)
- Обновлён FrameNode с поддержкой layout properties
- Обновлён App.tsx для инициализации yoga при загрузке
- Обновлён FrameRenderer для расчёта layout когда autoLayout включён
- E2E тест пройден: WASM загружается, Yoga.Node создаётся, layout вычисляется корректно

Следующие шаги:
- Layout properties в UI (direction, gap, padding, align)

---

=== 2026-01-24 | Feature 9: Layout properties в UI ===

Статус: PASSED ✓

Выполнено:
- Добавлен SelectInput компонент в PropertyInputs.tsx (dropdown)
- Добавлен CheckboxInput компонент в PropertyInputs.tsx (toggle)
- Добавлена секция "Auto Layout" в PropertiesPanel.tsx для Frame узлов
- UI для выбора direction (Horizontal/Vertical)
- Input для gap между элементами
- Inputs для padding (T, R, B, L)
- UI для alignItems (Start, Center, End, Stretch)
- UI для justifyContent (Start, Center, End, Space Between)
- E2E тест пройден: все контролы отображаются и изменяют свойства layout

Следующие шаги:
- fill_container / fit_content sizing

---

=== 2026-01-24 | Feature 10: fill_container / fit_content sizing ===

Статус: PASSED ✓

Выполнено:
- Добавлены типы SizingMode ('fixed' | 'fill_container' | 'fit_content') и SizingProperties в scene.ts
- Создан src/utils/nodeUtils.ts с функциями findParentFrame() и findNodeById() для навигации по дереву
- Обновлён sceneStore.ts с рекурсивной функцией updateNodeRecursive() для вложенных узлов
- Модифицирован yogaLayout.ts: createYogaChildNode() теперь поддерживает sizing modes
  - fill_container: flexGrow(1), flexShrink(1), flexBasis(0) на главной оси, alignSelf(STRETCH) на поперечной
  - fit_content: автоматический размер (Yoga auto)
  - fixed: явное указание width/height (по умолчанию)
- Обновлён applyLayoutToChildren() для применения вычисленных размеров при non-fixed mode
- Добавлен SegmentedControl компонент в PropertyInputs.tsx (Fixed/Fill/Fit кнопки)
- Интегрирован UI в PropertiesPanel.tsx: контролы sizing отображаются только внутри auto-layout Frame
- E2E тест пройден: width Fill растягивает элемент на 200px (ширина Frame), height Fill - на 150px

Следующие шаги:
- Nested auto-layout frames

---

=== 2026-01-24 | Feature 11: Nested auto-layout frames ===

Статус: PASSED ✓

Выполнено:
- Добавлена функция calculateFrameIntrinsicSize() для вычисления intrinsic размера вложенных фреймов
- Обновлена createYogaChildNode() для детекции вложенных auto-layout фреймов и использования их intrinsic size
- Добавлена helper функция createYogaChildNodeWithIntrinsicSize() для рекурсивного расчёта layout
- Исправлен deleteNode() - теперь работает рекурсивно для вложенных узлов
- E2E тест пройден: внешний Frame (Vertical) + внутренний Frame (Horizontal) с 3 прямоугольниками

Следующие шаги:
- Удаление элементов клавишей Backspace/Delete

---

=== 2026-01-24 | Feature 12: Удаление элементов клавишей Backspace/Delete ===

Статус: PASSED ✓

Выполнено:
- Добавлен deleteNode в useSceneStore hook в Canvas.tsx
- Добавлена обработка Delete и Backspace в handleKeyDown - удаляет все выделенные элементы
- Добавлена проверка что пользователь не печатает в input/textarea (не удалять при редактировании)
- Добавлена обработка Escape - снимает выделение без удаления
- E2E тест пройден: Delete удаляет один элемент
- E2E тест пройден: Backspace удаляет множественное выделение (3 элемента за раз)
- E2E тест пройден: Escape снимает выделение без удаления элемента

Следующие шаги:
- Отображение вложенности в панели Layers

---

=== 2026-01-24 | Feature 13: Отображение вложенности в панели Layers ===

Статус: PASSED ✓

Выполнено:
- Добавлен expandedFrameIds в sceneStore для хранения развёрнутых Frame
- Добавлены методы toggleFrameExpanded, setFrameExpanded для expand/collapse
- Исправлен toggleVisibility и setVisibility на рекурсивный поиск для вложенных узлов
- Добавлен moveNode метод для перемещения узлов между родителями (drag-n-drop)
- Переписан LayersPanel.tsx с рекурсивным рендером (LayerItem + LayerList)
- Добавлен отступ через depth prop (padding-left = 12 + depth * 16px)
- Добавлен ChevronIcon для expand/collapse на Frame с детьми
- Реализован drag-n-drop с определением позиции: before/after/inside
- E2E тест пройден: вложенные элементы отображаются с отступом
- E2E тест пройден: expand/collapse работает (chevron поворачивается)
- E2E тест пройден: клик на вложенный слой выделяет его на canvas
- E2E тест пройден: drag-n-drop переносит элемент внутрь Frame

Следующие шаги:
- Отмена и повтор действий (Undo/Redo)

---

=== 2026-01-24 | Feature 14: Отмена и повтор действий (Undo/Redo) ===

Статус: PASSED ✓

Выполнено:
- Создан src/store/historyStore.ts с past/future стеками (max 50 состояний)
- Реализованы методы: saveHistory, undo, redo, canUndo, canRedo, clear
- Добавлен batch mode для группировки операций (startBatch/endBatch)
- Модифицирован sceneStore.ts - добавлен saveHistory вызов перед каждой мутацией
- Добавлен setNodesWithoutHistory метод для применения undo/redo без записи в историю
- Добавлены keyboard shortcuts в Canvas.tsx: Cmd/Ctrl+Z (undo), Cmd/Ctrl+Shift+Z (redo)
- Удаление множественных элементов работает как одна операция undo (batch mode)
- E2E тест пройден: Cmd+Z отменяет создание элемента
- E2E тест пройден: Cmd+Shift+Z повторяет отменённое действие
- E2E тест пройден: Cmd+Z восстанавливает удалённые элементы
- E2E тест пройден: Cmd+Z отменяет изменения свойств (fill color)

Следующие шаги:
- Variable system (определение переменных)

---

=== 2026-01-24 | Feature 15: Variable system (определение переменных) ===

Статус: PASSED ✓

Выполнено:
- Созданы типы Variable и VariableType в src/types/variable.ts
- Создан Zustand store для переменных (src/store/variableStore.ts)
- Обновлена сериализация в fileUtils.ts - PenDocument теперь включает variables
- Создан компонент VariablesPanel.tsx с UI для управления переменными
- Header с названием, счётчиком и кнопкой Add (+)
- List items с color swatch, name, delete button (on hover)
- Inline editing: double-click на name, color picker для value
- Интегрирована панель в RightSidebar (над LayersPanel)
- Обновлён Toolbar.tsx для save/open с переменными
- E2E тест пройден: add variable, delete variable, save/open с переменными

Следующие шаги:
- Theme switching (light/dark)

---

=== 2026-01-24 | Feature 16: Theme switching (light/dark) ===

Статус: PASSED ✓

Выполнено:
- Добавлены типы ThemeName, ThemeValues в src/types/variable.ts
- Добавлены helper функции getVariableValue(), ensureThemeValues()
- Создан Zustand store для темы (src/store/themeStore.ts)
- Добавлен метод updateVariableThemeValue() в variableStore
- Добавлен themeOverride в FrameNode (src/types/scene.ts)
- Обновлена сериализация в fileUtils.ts с миграцией старых документов
- Обновлён VariablesPanel.tsx с Theme Toggle (sun/moon icons)
- Dual color swatches для light/dark значений переменных
- Обновлён Toolbar.tsx для save/load с activeTheme
- Добавлена секция Theme Override в PropertiesPanel для Frame
- E2E тест пройден: theme toggle, dual swatches, frame override dropdown

Следующие шаги:
- Variable picker в properties panel

---

=== 2026-01-24 | Feature 17: Variable picker в properties panel ===

Статус: PASSED ✓

Выполнено:
- Добавлен тип ColorBinding в src/types/scene.ts для привязки переменных
- Добавлены поля fillBinding и strokeBinding в BaseNode
- Расширен ColorInput в PropertyInputs.tsx с variable picker dropdown
- При наличии привязки показывается имя переменной с кнопкой Unbind
- Кнопка "Bind to variable" открывает dropdown с доступными переменными
- Интегрированы переменные в PropertiesPanel для fill/stroke
- Обновлён RenderNode.tsx для разрешения переменных в цвета
- Поддержка effectiveTheme для наследования темы от родителя
- ThemeOverride на Frame корректно передаётся дочерним элементам
- E2E тест пройден: bind variable, unbind variable, theme switching

Следующие шаги:
- WebSocket server (Phase 4: MCP Server)

---

=== 2026-01-24 | Feature 18: Infinite canvas (бесконечный холст как в Figma) ===

Статус: PASSED ✓

Выполнено:
- Создан компонент Grid.tsx с динамической сеткой (10px мелкая + 100px крупная)
- Сетка масштабируется с zoom, мелкая сетка скрывается при scale < 0.3
- Создан viewportUtils.ts с функциями для viewport culling
- Обновлён Canvas.tsx: интеграция Grid, viewport culling для узлов
- Обновлён viewportStore.ts: добавлен метод fitToContent()
- Обновлён Toolbar.tsx: добавлена секция View с кнопкой "Fit All"
- Добавлен hotkey Cmd/Ctrl+0 для zoom to fit
- Убран статический фон 2000x2000, canvas теперь бесконечный
- E2E тест пройден: сетка отображается, Fit All центрирует элементы

Следующие шаги:
- Ограничение перемещения элементов внутри auto-layout frames

---

=== 2026-01-24 | Feature 19: Ограничение перемещения элементов внутри auto-layout frames ===

Статус: PASSED ✓

Выполнено:
- Создан src/store/dragStore.ts для глобального состояния drag
- Создан src/utils/dragUtils.ts с утилитами расчёта drop-позиции
- Создан src/components/DropIndicator.tsx - Konva компонент для визуального индикатора
- Модифицирован RenderNode.tsx - условная логика drag для auto-layout элементов
- Элементы внутри auto-layout frame не перемещаются свободно (позиции сбрасываются после drag)
- Drag-out из auto-layout frame переносит элемент на root уровень
- Интегрирован drop indicator в Canvas.tsx
- E2E тест пройден: drag-out из Frame работает корректно

Следующие шаги:
- Inline переименование элементов в Layers Panel

---

=== 2026-01-24 | Feature 20: Inline переименование элементов в Layers Panel ===

Статус: PASSED ✓

Выполнено:
- Добавлен inline editing state в LayerItem (isEditing, editName, inputRef)
- Добавлен useEffect для автофокуса input при начале редактирования
- Добавлены обработчики: handleDoubleClick, handleNameSubmit, handleNameKeyDown, handleNameBlur
- Двойной клик на имени слоя активирует режим редактирования
- Enter сохраняет новое имя через updateNode()
- Escape отменяет редактирование без сохранения
- Blur (клик вне) сохраняет изменения
- E2E тест пройден: double-click → edit → Enter сохраняет
- E2E тест пройден: double-click → edit → Escape отменяет

Следующие шаги:
- Свойство Rotation в Properties Panel

---

=== 2026-01-24 | Feature 21: Свойство Rotation в Properties Panel ===

Статус: PASSED ✓

Выполнено:
- Добавлен rotation?: number в BaseNode (src/types/scene.ts)
- Добавлена секция Rotation в PropertiesPanel.tsx с NumberInput (0-360°)
- Добавлен rotation prop ко всем Konva рендерерам (Rect, Ellipse, Text, Group)
- Обновлён handleTransformEnd для захвата rotation от Transformer
- Rotation автоматически сохраняется/загружается в JSON документ
- E2E тест пройден: ввод 45° → элемент повёрнут → Save → Reload → Open → rotation восстановлен

Следующие шаги:
- Inline редактирование текста на canvas

---

=== 2026-01-25 | Feature 22: Inline редактирование текста на canvas ===

Статус: PASSED ✓

Выполнено:
- Добавлен editingNodeId state в selectionStore.ts для отслеживания редактируемого узла
- Добавлены методы startEditing() и stopEditing() в selectionStore
- Создан компонент InlineTextEditor.tsx (HTML textarea overlay)
- Позиционирование overlay с учётом viewport transforms (scale, x, y)
- Auto-focus и select all при открытии редактора
- Добавлен onDblClick handler в RenderNode.tsx для Text узлов
- Konva Text скрывается (opacity: 0) во время редактирования
- Интегрирован InlineTextEditor в Canvas.tsx
- Enter сохраняет изменения и закрывает редактор
- Escape отменяет изменения без сохранения
- Blur (клик вне) сохраняет изменения
- E2E тест пройден: double-click → type → Enter → text saved
- E2E тест пройден: double-click → type → Escape → text preserved
- E2E тест пройден: double-click → type → blur → text saved

Следующие шаги:
- Отображение названия frame на canvas (Phase 4: Advanced Editing)

---

=== 2026-01-25 | Feature 23: Отображение названия frame на canvas с inline-редактированием ===

Статус: PASSED ✓

Выполнено:
- Добавлен editingMode в selectionStore для различения типа редактирования (text vs name)
- Добавлен метод startNameEditing() в selectionStore
- Создан компонент FrameNameLabel.tsx - Konva Text над frame с названием
- Создан компонент InlineNameEditor.tsx - HTML input для редактирования названия
- Добавлена функция getNodeAbsolutePosition() в nodeUtils.ts для вложенных фреймов
- Интегрирован FrameNameLabel в FrameRenderer
- Интегрирован InlineNameEditor в Canvas.tsx
- Название отображается над frame слева (как в Figma)
- Синий цвет названия когда frame выделен
- Двойной клик на названии активирует inline редактирование
- Enter сохраняет новое название
- Название синхронизируется с Layers Panel
- E2E тест пройден через Playwright

Следующие шаги:
- Ширина, выравнивание, высота строки и letter spacing для текста

---

=== 2026-01-25 | Feature 25: Ширина, выравнивание, высота строки и letter spacing для текста ===

Статус: PASSED ✓

Выполнено:
- Добавлены типы TextWidthMode и TextAlign в src/types/scene.ts
- Добавлены свойства textWidthMode, textAlign, lineHeight, letterSpacing в TextNode
- Обновлён RenderNode.tsx - Konva Text получает align, lineHeight, letterSpacing
- При textWidthMode='auto' - width не передаётся (Konva рассчитывает автоматически)
- Добавлена секция "Text Layout" в PropertiesPanel.tsx
- SegmentedControl для Width (Auto/Fixed) и Align (L/C/R)
- NumberInput для Line Height (default 1.2, step 0.1) и Letter Spacing (default 0, step 0.5)
- Обновлён InlineTextEditor.tsx с поддержкой lineHeight и letterSpacing
- При fixed width mode редактор использует фиксированную ширину узла
- Все свойства сохраняются и загружаются в JSON документ
- E2E тест пройден через Playwright: все контролы работают, save/load корректен

Следующие шаги:
- Feature 26: Определение компонентов (reusable)

---

=== 2026-01-25 | Feature 26: Определение компонентов (reusable) ===

Статус: PASSED ✓

Выполнено:
- Добавлен reusable?: boolean в FrameNode (src/types/scene.ts)
- Обновлён NodeIcon в LayersPanel - 4 ромба для reusable frames (как в Figma)
- Добавлена секция "Component" в PropertiesPanel с кнопкой Create Component
- При клике на Create Component устанавливается reusable: true
- Показывается индикатор "This is a Component" и кнопка "Detach Component"
- Компоненты сохраняются и загружаются в JSON документ
- E2E тест пройден через Playwright: create component, save/load работает

Следующие шаги:
- Feature 27: Создание инстансов (ref nodes)

---

=== 2026-01-25 | Feature 27: Создание инстансов (ref nodes) ===

Статус: PASSED ✓

Выполнено:
- Добавлен тип RefNode в src/types/scene.ts (type: 'ref', componentId: string)
- Добавлены функции findComponentById() и getAllComponents() в src/utils/nodeUtils.ts
- Создан InstanceRenderer в RenderNode.tsx для рендеринга ref-нод
- Инстанс отображает содержимое компонента (фон, дети) с масштабированием
- Добавлена иконка ромба для инстансов в LayersPanel.tsx
- Создан ComponentsPanel.tsx - панель со списком компонентов
- Клик на компонент в панели создаёт инстанс в центре viewport
- Обновлён PropertiesPanel.tsx - секция "Instance of: [Component Name]"
- Интегрирован ComponentsPanel в LeftSidebar
- E2E тест пройден через Playwright:
  - Создание компонента (reusable: true)
  - Создание инстанса через Components Panel
  - Инстанс отображает содержимое компонента (Rectangle внутри)
  - Изменение компонента обновляет инстанс
  - Save/Load корректно сохраняет и загружает ref-ноды

Следующие шаги:
- Feature 28: Переопределение свойств в инстансах (overrides)

---

=== 2026-01-25 | Feature 28: Переопределение свойств в инстансах (overrides) ===

Статус: PASSED ✓

Выполнено:
- Модифицирован InstanceRenderer в RenderNode.tsx для merge свойств инстанса и компонента
- Инстанс приоритет над компонентом: если node.fill !== undefined, используется node.fill
- Добавлен компонент OverrideIndicator в PropertiesPanel.tsx (кнопка reset)
- Добавлена логика isOverridden() для определения переопределённых свойств
- Fill и Stroke секции показывают кнопку Reset при наличии override
- Секция Instance показывает список overrides и кнопку "Reset All Overrides"
- Сериализация работает автоматически (свойства RefNode сохраняются в JSON)
- E2E тест пройден через Playwright:
  - Создание компонента с fill=#FF0000
  - Создание инстанса и изменение fill на #0000FF
  - Override indicator появляется, показывает "Overrides (1): Fill"
  - Reset возвращает цвет к значению компонента
  - Save/Load корректно сохраняет и загружает overrides

Следующие шаги:
- Feature 29: Переопределение вложенных нод (descendants)

---

=== 2026-01-25 | Feature 29: Переопределение вложенных нод (descendants) ===

Статус: PASSED ✓

Выполнено:
- Добавлен enabled?: boolean в BaseNode для скрытия нод через overrides
- Добавлены типы DescendantOverride и DescendantOverrides в scene.ts
- Добавлено поле descendants?: DescendantOverrides в RefNode
- Добавлен instance edit mode в selectionStore (double-click для входа)
- Добавлены методы enterInstanceEditMode(), exitInstanceEditMode(), selectDescendant()
- Добавлены методы updateDescendantOverride(), resetDescendantOverride() в sceneStore
- Обновлён InstanceRenderer для поддержки edit mode и применения overrides
- Добавлен DescendantRenderer для рендеринга детей с selection highlight
- Добавлен RenderNodeWithOverrides для рендеринга детей без edit mode
- Добавлен DescendantPropertyEditor в PropertiesPanel
- UI для Fill, Stroke, Enabled с override indicators и Reset buttons
- ESC ключ выходит из instance edit mode
- Сериализация descendants работает автоматически в JSON

Следующие шаги:
- Feature 30: Варианты компонентов (variant refs)

---

=== 2026-01-26 | Feature: Исправление позиции текстового редактора во вложенных auto-layout ===

Статус: PASSED ✓

Выполнено:
- Создана функция getNodeAbsolutePositionWithLayout() в src/utils/nodeUtils.ts
- Функция рекурсивно обходит дерево и вызывает calculateLayoutForFrame для auto-layout фреймов
- Использует вычисленные Yoga позиции вместо сохранённых node.x/y
- Модифицирован InlineTextEditor.tsx - добавлены props absoluteX и absoluteY
- Обновлён Canvas.tsx - вычисляет абсолютную позицию для текстового редактора
- E2E тест пройден: текстовый редактор корректно позиционируется внутри вложенных auto-layout фреймов

Следующие шаги:
- Feature: Создание компонента клавишей Opt+Cmd+K

---

=== 2026-01-26 | Feature: Создание компонента клавишей Opt+Cmd+K ===

Статус: PASSED ✓

Выполнено:
- Добавлен updateNode selector из sceneStore в Canvas.tsx
- Добавлен обработчик клавиш Opt+Cmd+K (Mac) / Alt+Ctrl+K (Windows) в handleKeyDown
- Хоткей работает только для Frame нод (не для rect, ellipse, text)
- Хоткей не применяется к уже существующим компонентам (reusable: true)
- Добавлен updateNode в dependency array useEffect
- E2E тест пройден через Playwright:
  - Opt+Cmd+K превращает Frame в компонент (иконка 4 ромба в Components Panel)
  - Повторное нажатие ничего не меняет
  - Rectangle не превращается в компонент

Следующие шаги:
- Feature: Перемещение нод стрелками клавиатуры внутри auto-layout

---

=== 2026-01-26 | Feature: Перемещение нод стрелками клавиатуры внутри auto-layout ===

Статус: PASSED ✓

Выполнено:
- Добавлен импорт findParentFrame из nodeUtils в Canvas.tsx
- Добавлен moveNode selector из sceneStore
- Добавлен обработчик Arrow keys в handleKeyDown (между Delete/Backspace и Escape)
- Логика определения направления layout (horizontal/vertical)
- ArrowLeft/ArrowRight работают только в horizontal layout (flexDirection: 'row')
- ArrowUp/ArrowDown работают только в vertical layout (flexDirection: 'column')
- Стрелки игнорируются для нерелевантного направления
- Работает только для элементов внутри auto-layout фреймов
- История сохраняется (Undo работает)
- Добавлен moveNode в dependency array useEffect
- E2E тест пройден через Playwright:
  - ArrowLeft перемещает элемент влево в horizontal layout
  - ArrowRight перемещает элемент вправо в horizontal layout
  - ArrowUp/ArrowDown игнорируются в horizontal layout
  - ArrowUp перемещает элемент вверх в vertical layout

Следующие шаги:
- Feature: Варианты компонентов (variant refs)

---

=== 2026-01-26 | Feature: Секция экспорта выделенных элементов в PNG/JPEG ===

Статус: PASSED ✓

Выполнено:
- Создан src/store/canvasRefStore.ts - Zustand store для хранения ссылки на Konva Stage
- Создан src/utils/exportUtils.ts - утилиты экспорта с функциями:
  - exportNodeAsImage() - экспорт конкретного элемента
  - exportCanvasAsImage() - экспорт всего canvas
  - exportImage() - универсальная функция (элемент или canvas)
- Обновлён Canvas.tsx - регистрация stageRef в store через useEffect
- Обновлён PropertiesPanel.tsx - добавлена секция Export:
  - Scale dropdown (1x, 2x, 3x)
  - Кнопки PNG и JPEG
  - Текст "Export [имя элемента]" или "Export entire canvas"
- Поддержка pixelRatio для масштабирования (1x, 2x, 3x)
- JPEG качество 0.92 (как в Figma)
- Имя файла включает имя элемента и суффикс масштаба (@2x, @3x)
- E2E тест пройден через Playwright:
  - PNG экспорт элемента: Group.png
  - JPEG экспорт с 2x масштабом: Group@2x.jpg
  - Экспорт всего canvas: canvas@2x.png

Следующие шаги:
- Feature: Высота frame автоматически становится fit_content при включении auto-layout

---

=== 2026-01-26 | Feature: Высота frame автоматически становится fit_content при включении auto-layout ===

Статус: PASSED ✓

Выполнено:
- Добавлена функция calculateFrameIntrinsicHeight() в src/utils/yogaLayout.ts
- Функция вычисляет высоту Frame на основе содержимого через Yoga WASM
- Модифицирован PropertiesPanel.tsx - при включении auto-layout устанавливается sizing.heightMode = 'fit_content'
- Модифицирован FrameRenderer в RenderNode.tsx - использует effectiveHeight вместо node.height
- effectiveHeight вычисляется через calculateFrameIntrinsicHeight когда heightMode === 'fit_content'
- E2E тест пройден через Playwright:
  - Horizontal layout: effectiveHeight = 100 (один Rectangle)
  - Vertical layout: effectiveHeight = 200 (два Rectangle'а по 100px)
  - Высота Frame динамически подстраивается под содержимое

Следующие шаги:
- Feature: Плавный зум canvas как в Figma

---

=== 2026-01-26 | Feature: Width fit_content для top-level auto-layout Frame ===

Статус: PASSED ✓

Выполнено:
- Расширена функция calculateFrameIntrinsicSize() в yogaLayout.ts для поддержки fitWidth и fitHeight
- Модифицирован FrameRenderer - вычисляет effectiveWidth и effectiveHeight отдельно
- Теперь Frame с auto-layout может использовать fit_content для ширины (не только для высоты)
- Показаны sizing controls (W/H: Fixed/Fill/Fit) для Frame с auto-layout даже на верхнем уровне canvas
- E2E тест пройден: effectiveWidth=150, effectiveHeight=100 при fitW=true, fitH=true

Следующие шаги:
- Feature: Плавный зум canvas как в Figma

---

=== 2026-01-26 | Feature: Плавный зум canvas как в Figma ===

Статус: PASSED ✓

Выполнено:
- Расширен viewportStore.ts с анимацией зума через requestAnimationFrame
- Добавлены targetScale, zoomCenterX/Y, animationFrameId для состояния анимации
- Реализована функция startSmoothZoom() с накоплением delta при быстрой прокрутке
- Easing интерполяция: scale += (targetScale - scale) * EASING_FACTOR
- Зум центрируется на позиции курсора во время всей анимации
- Модифицирован handleWheel в Canvas.tsx для использования startSmoothZoom
- Удалён неиспользуемый ZOOM_FACTOR
- Параметры анимации: EASING_FACTOR=0.85, ZOOM_INTENSITY=0.008
- E2E тест пройден: zoom in, zoom out, накопление delta, fitToContent работает

Следующие шаги:
- Feature: Отображение размеров выбранной ноды снизу по центру

---

=== 2026-01-26 | Feature: Отображение размеров выбранной ноды снизу по центру ===

Статус: PASSED ✓

Выполнено:
- Создан компонент NodeSizeLabel.tsx по аналогии с FrameNameLabel
- Отображает размеры в формате "width × height" (например "150 × 100")
- Позиционируется снизу по центру выбранной ноды
- Масштабируется с viewportом через scaleX/scaleY = 1/scale
- Поддержка drag и transform tracking (размеры обновляются во время перемещения/изменения размера)
- Поддержка effective size для auto-layout фреймов с fit_content
- Добавлен collectSelectedNodes useMemo в Canvas.tsx
- Интегрирован NodeSizeLabel после FrameNameLabel в Layer
- E2E тест пройден: Rectangle показывает 150×100, Frame показывает 200×150

Следующие шаги:
- Feature: Варианты компонентов (variant refs)

---
