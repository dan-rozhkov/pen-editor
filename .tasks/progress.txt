[2026-02-09] Implemented auto-parenting for newly drawn nodes into frames (Konva + Pixi). Added findTopmostFrameIntersectingRectWithLayout() in nodeUtils.ts to locate the top-most/deepest intersecting frame by world-space bounds with layout-aware positions. Updated draw node creation in useCanvasPointerHandlers.ts and pixiInteraction.ts to insert the new node via addChildToFrame with coordinates converted to frame-local space. Tested: npm run build passes.

[2026-02-09] Fixed draw-mode hit passthrough on Konva canvas. While a draw tool is active, interactive Konva layers now set listening=false, so existing nodes and frame labels under the cursor no longer receive click/drag/selection events during drawing. Updated Canvas.tsx to gate both scene and labels layers with !isDrawToolActive. Tested: npm run build passes.

[2026-02-09] Fixed Pixi multi-select parity with Konva for modifier clicks. Updated pixiInteraction.ts so Cmd/Ctrl/Shift-modified clicks are treated as selection gestures (no immediate drag start), which restores reliable Cmd+Shift additive selection behavior. Also aligned nested hit-testing with Konva by returning already-selected child nodes before parent override logic. Tested: npm run build passes; pixi-konva-multiselect.spec.mjs passes in both renderers (Cmd+Shift click and marquee additive selection).

[2026-01-29] Fixed visibility toggle bug by adding node.visible check in viewportUtils.isNodeVisible() function. Canvas content no longer disappears when toggling node visibility.

[2026-01-29] Implemented system font selection feature for text nodes. Created fontUtils.ts with Font Access API (fallback to common fonts), built FontCombobox component with search/filter and live preview, updated PropertiesPanel to use the new selector. Default font set to Arial. Shows all 300+ system fonts immediately on open, filters as user types. All tests passed: font selection, search, custom font entry, API fallback, text measurement updates.

[2026-01-29] Implemented element opacity feature. Added opacity property (0-1) to BaseNode type, added Opacity % input to PropertiesPanel between Rotation and Fill sections, applied opacity to all Konva renderers (Rect, Ellipse, Text, Frame Group, Instance Group, DescendantRenderer, RenderNodeWithOverrides). Tested: real-time visual update, 0%/50%/100% range, save/load persistence confirmed.

[2026-01-29] Implemented page background feature. Added pageBackground state and setPageBackground action to sceneStore, replaced hard-coded #f5f5f5 in Canvas with store value, added PageProperties component to PropertiesPanel that shows "Page > Background" color picker when nothing is selected. Tested: color picker visible when deselected, hidden when node selected, canvas background updates in real-time.

[2026-01-29] Implemented group/ungroup elements feature. Added GroupNode type and isContainerNode helper to scene.ts. Updated all recursive helpers across sceneStore, nodeUtils, dragUtils, viewportUtils, and PropertiesPanel to handle groups. Added groupNodes/ungroupNodes actions to sceneStore with bounding-box calculation and position adjustment. Created GroupRenderer in RenderNode.tsx (transparent hitbox, dashed hover outline, no background fill). Added Cmd+G / Cmd+Shift+G keyboard shortcuts in Canvas.tsx. Updated FrameNameLabel to show "Group" default name. Implemented Figma-like click behavior: single-click on group child selects group, double-click enters group and selects child. Updated LayersPanel for group display with expand/collapse. Tested: group creation, layers panel nesting, ungroup, nested groups, single-click selects group, double-click enters group.

[2026-01-29] Implemented image fill feature. Added ImageFill interface (url + mode) and imageFill property to BaseNode in scene.ts. Created useLoadImage hook with caching for loading images from data URIs or URLs. Added ImageFillLayer component to RenderNode.tsx with clip-based rendering for rect, ellipse, and frame nodes, supporting fill/fit/stretch scale modes. Integrated into all renderers (main RenderNode, EllipseRenderer, FrameRenderer, DescendantRenderer, RenderNodeWithOverrides). Added ImageFillSection to PropertiesPanel with file upload, URL input, scale mode dropdown, preview thumbnail, and remove button. Tested: file upload sets image fill, image renders on canvas, scale mode switching works, save/load persistence confirmed, preview displays in properties panel.

[2026-01-29] Implemented flip horizontal/vertical feature. Added flipX and flipY boolean properties to BaseNode in scene.ts. Added Flip section with toggle buttons (↔ Horizontal / ↕ Vertical) to PropertiesPanel between Rotation and Opacity sections. Applied Konva scaleX/scaleY transforms with offsetX/offsetY correction to all renderers: Rect, Ellipse, Text, FrameRenderer, GroupRenderer, InstanceRenderer, DescendantRenderer, and RenderNodeWithOverrides. Updated handleTransformEnd in both main RenderNode and EllipseRenderer to preserve flip state during resize transforms. Tested: flip toggles on rect/ellipse/text, visual rendering correct, save/load persistence confirmed, button state reflects loaded flip values.

[2026-01-29] Implemented Figma-like nested element selection. Added enteredContainerId state with enterContainer/resetContainerContext methods to selectionStore.ts. Added isDescendantOf utility to nodeUtils.ts for ancestry checks. Updated RenderNode.tsx with selectOverrideId prop system: depth-1 children of top-level frames are directly selectable with single click, deeper elements select their nearest depth-1 ancestor container instead. Double-click on a container enters it (sets enteredContainerId), making its children directly selectable. Each subsequent double-click drills one level deeper. Clicking empty canvas resets the nesting context. Applied same logic to both FrameRenderer and GroupRenderer. Tested: single click selects depth-1 elements, click on depth-2+ selects parent container, double-click enters container and selects child, empty canvas click resets nesting level.

[2026-01-29] Fixed auto-width with auto-layout (fit_content) bug. The frame was not shrink-wrapping to content because createYogaNodeForFrame() and calculateFrameLayout() in yogaLayout.ts always constrained Yoga to the frame's stored width/height, ignoring fit_content sizing mode. Fixed by skipping setWidth/setHeight on the Yoga node and passing undefined to calculateLayout() when the frame has fit_content sizing. Tested: created frame with vertical auto-layout, padding 16, gap 10, three children of widths 34/120/200 — frame correctly shrinks to 232x138 (widest child + padding), no extra space.

[2026-01-29] Implemented convert Group to Frame and vice versa. Added convertNodeInTree helper and replaceNodeInTree utility in sceneStore.ts. Added convertNodeType action to SceneState that converts group→frame (preserving all base props + children) and frame→group (stripping cornerRadius, layout, themeOverride, reusable). Reusable frames (components) are blocked from conversion. Added "Convert to Frame"/"Convert to Group" button in PropertiesPanel Convert section. Tested: group→frame conversion shows frame-specific properties (Auto Layout, Theme Override, Component, Radius), frame→group strips them, undo/redo works correctly, reusable frame hides convert button, layers panel icon updates.

[2026-01-31] Fixed paste into selected container. Modified paste handler in useCanvasKeyboardShortcuts.ts to check if the selected node is a container (frame or group) when pasting. If so, uses addChildToFrame to insert the cloned node as a child at position (20, 20) inside the container. If no container is selected, paste still works at root level as before. Added addChildToFrame prop to the keyboard shortcuts hook, passed from Canvas.tsx. Tested: paste into frame (node appears as child in layers panel at correct position), paste into group (same), paste with no selection (root level, unchanged behavior).

[2026-01-31] Expanded variable types from color-only to color, number, and string. Extended VariableType union in variable.ts, added VariableBinding type alias in scene.ts (ColorBinding now alias), added resolveVariableValue and resolveNumberVariable helpers in colorUtils.ts. Rewrote VariablesPanel.tsx with type selector dropdown (Color/Number/String with colored badges C/#/T), type-specific editors (color swatches for color, inline editable number/text inputs for number/string), and per-type default naming. All variable types support light/dark theme values. Tested: create color/number/string variables, edit theme-specific values, theme toggle displays correct values, save/load preserves all types, color variable binding to fill still works correctly, variable picker filters by type.

[2026-01-31] Implemented smart guides (snap lines) on drag. Created smartGuideStore.ts (Zustand store for active guide lines), smartGuideUtils.ts (snap edge collection and calculation with 9-combination matching per axis), and SmartGuides.tsx (Konva Line rendering with 1/scale stroke width). Modified RenderNode.tsx drag handlers: handleDragStart caches snap targets and parent offset, handleDragMove computes absolute position and snaps to nearest guide within threshold (5px/scale), handleDragEnd clears guides. Added SmartGuides component to Canvas.tsx Layer. Supports all 6 alignment types: left, right, top, bottom, centerX, centerY. Auto-layout children skip snapping. Tested: horizontal guide appears on top-edge alignment with snap (Y=156), vertical guide on left-to-right edge alignment with snap (X=110), guides disappear after drag end.

[2026-01-31] Implemented spacing between selected nodes in Properties Panel. Added calculateSpacing and distributeSpacing functions to alignmentUtils.ts with dominant axis detection, gap calculation, and uniform redistribution logic. Added SpacingInput component to AlignmentSection in PropertiesPanel.tsx that shows a numeric input when 2+ non-auto-layout nodes are selected. Shows numeric gap value when all gaps are equal, "mixed" placeholder when gaps differ, hidden for single selection or auto-layout nodes. Editing the value redistributes nodes with uniform spacing. Tested: spacing input appears with correct value (70), change to 20 moves nodes closer, mixed state shown for unequal gaps, entering value from mixed equalizes spacing, single selection hides input.

[2026-01-31] Fixed integer x/y on drag. Added Math.round() to target.x() and target.y() in handleDragEnd in RenderNode.tsx (normal drag) and to the position calculation in handleAutoLayoutDragEnd in dragUtils.ts (drag out of auto-layout frame). Manual fractional input via Properties Panel is unaffected. Tested: drag produces integer x/y values, manual fractional input still accepted, drag after fractional manual input rounds correctly.

[2026-01-31] Implemented select all nodes (Cmd/Ctrl+A). Added keyboard shortcut handler in useCanvasKeyboardShortcuts.ts that selects all visible top-level nodes on Cmd/Ctrl+A. Context-aware: if user has entered a container (group/frame) via double-click, selects only that container's children instead. Uses preventDefault to block browser text selection. Tested: Cmd+A selects all top-level nodes (4 layers selected), double-click into group then Cmd+A selects only group children (2 layers selected).

[2026-01-31] Converted Variables Panel from sidebar to Dialog with table layout. Rewrote VariablesPanel.tsx as VariablesDialog component using Dialog UI primitives, with 3-column table (Name, Light, Dark) matching Figma reference. All values editable inline: click-to-edit for names and number/string values, native color picker for color variables. Added "Variables" button to Toolbar.tsx, removed panel from RightSidebar.tsx. Supports add (Color/Number/String via dropdown or footer button), delete (hover trash icon), and close (Escape/overlay). Tested: dialog opens from toolbar, table displays all variable types correctly, inline editing of name/light/dark values works, add/delete variables works, dialog closes properly.

[2026-01-31] Implemented custom color picker using React Aria. Installed react-aria-components and created CustomColorPicker component (src/components/ui/ColorPicker.tsx) with ColorArea (HSB saturation/brightness), ColorSlider (hue), and ColorField (hex input) in a click-to-open popover. Replaced native <input type="color"> in PropertyInputs.tsx (Fill/Stroke sections) and VariablesPanel.tsx (color variable cells). Supports two swatch sizes (sm for variables, md for properties). Variable binding preserved and working. Tested: picker opens on swatch click, color area and hue slider update canvas in real-time, hex input works, variable binding/unbinding works, popover closes on outside click.

[2026-01-31] Implemented deep select with Cmd/Ctrl+Click modifier. Modified handleClick in RenderNode.tsx to detect metaKey/ctrlKey and bypass selectOverrideId, selecting the actual clicked node regardless of nesting depth. Tested: normal click on nested rect selects parent Group (depth-1 container), Cmd+Click on same rect selects the Rect directly, layers panel highlights correct node.

[2026-01-31] Implemented SVG file import with path node rendering. Added PathNode type (with geometry, pathStroke, geometryBounds fields) and PathStroke interface to scene.ts. Created PathRenderer.tsx using Konva Path component with geometry offset correction, transparent hit rect, and flip/rotation support. Created svgUtils.ts with DOMParser-based SVG parsing that extracts <path> elements (with fill, stroke, stroke-width, linejoin, linecap), computes bounding boxes via offscreen SVG, handles nested <g> translate transforms, and wraps multiple paths in a GroupNode. Added "Insert SVG" button to Toolbar.tsx with file picker, viewport-center placement, and auto-selection. Added PenNib icon for path nodes in LayersPanel.tsx. Tested: single-path and multi-path SVG import, correct rendering with fills/strokes/colors, save/load persistence, selection and properties panel integration.

[2026-01-31] Implemented distance measurement overlay (Ctrl/Cmd + hover). Created measureStore.ts (Zustand store for measurement lines and modifier key state), measureUtils.ts (computeParentDistances for padding to 4 parent edges, computeSiblingDistances for horizontal/vertical gaps between sibling nodes), and MeasureOverlay.tsx (Konva component rendering red #f24822 lines with end caps and centered labels with red background/white text, zoom-independent via 1/scale). Added modifier key tracking (keydown/keyup/blur) in Canvas.tsx. Modified RenderNode.tsx handleMouseEnter to detect modifier+selection and compute measurement lines using isDescendantOf for parent vs sibling detection. Tested: sibling gap measurement (100px horizontal), parent-child padding (20/20/160/160 for all 4 edges), lines disappear on modifier release, lines disappear on mouse leave.

[2026-02-01] Implemented frame size presets in right sidebar. Added FramePresetsPanel component to PropertiesPanel.tsx with 15 device presets grouped by category (Mobile, Tablet, Desktop, TV). Each preset shows device name and dimensions. Panel appears when Frame tool is active (press F). Clicking a preset creates a frame with the specified dimensions centered in the current viewport, auto-selects it, and switches back to cursor mode. Added data-canvas attribute to Canvas.tsx for viewport center calculation. Tested: presets appear on frame tool activation, clicking iPhone 16 creates 393×852 frame, clicking Desktop HD creates 1920×1080 frame, frame appears in layers panel with correct name, tool resets to cursor after creation.

[2026-02-02] Implemented gradient fill (linear & radial). Added GradientColorStop, GradientType, GradientFill types and gradientFill field to BaseNode in scene.ts. Created gradientUtils.ts with buildKonvaGradientProps (converts normalized 0-1 coords to Konva fillLinearGradient*/fillRadialGradient* props), getDefaultGradient, interpolateColorAtPosition, and buildCSSGradient. Updated RenderNode.tsx to compute gradientProps and pass to all renderers. Updated RectRenderer, EllipseRenderer (center-based offset), FrameRenderer, TextRenderer, PathRenderer, and InstanceRenderer (both DescendantRenderer and RenderNodeWithOverrides) to accept and spread gradientProps, with gradient taking priority over solid fill (same as imageFill). Created GradientBar.tsx with CSS gradient preview, draggable stop markers, click-to-add stop with interpolated color. Created GradientEditor.tsx with GradientBar, CustomColorPicker per selected stop, position input, add/remove buttons (min 2 stops). Added Solid/Linear/Radial SelectInput to Fill section in PropertyEditor.tsx — switching preserves stops between gradient types. Tested: linear gradient on rect, radial gradient on rect, ellipse with gradient, switch back to solid, save/load persistence, undo/redo.

[2026-02-02] Fixed polygon transformer resize bug. Polygon points were generated centered on unit circle, causing Konva Line's computed bounding box to be smaller than stored width/height. Created generatePolygonPoints() utility in polygonUtils.ts that normalizes points to span exactly 0..width and 0..height. Updated all 5 point generation sites (RenderNode handleTransformEnd, useCanvasPointerHandlers, PropertyEditor W/H/Sides onChange) to use the shared utility. Tested: transformer resize produces correct dimensions, W/H panel input resize works, sides change works, repeated transforms stable.

[2026-02-02] Implemented box shadow effects. Added ShadowEffect interface (type, shadowType, color with hex alpha, offset x/y, blur, spread) and effect field to BaseNode in scene.ts. Created shadowUtils.ts with buildKonvaShadowProps (parses hex alpha, maps to Konva shadowColor/shadowBlur/shadowOffset/shadowOpacity, emulates spread via blur addition) and getDefaultShadow. Added shadowProps computation in RenderNode.tsx and passed to all renderers: RectRenderer, EllipseRenderer, FrameRenderer, TextRenderer, PathRenderer, LineRenderer, PolygonRenderer. Added Effects section to PropertyEditor.tsx with "+ Shadow" button, Drop Shadow editor (ColorInput, X/Y offset, Blur, Spread inputs), and Remove button. Added action prop to PropertySection component. Tested: shadow renders on rect and ellipse, real-time parameter updates (blur, offset), add/remove toggle, save/load persistence confirmed.

[2026-02-02] Implemented proportional resize lock (aspect ratio lock). Added aspectRatioLocked and aspectRatio properties to BaseNode in scene.ts. Added lock/unlock toggle button (LinkSimple/LinkSimpleBreak icons) between W and H inputs in PropertyEditor.tsx Size section. When locked, stores the aspect ratio (width/height) and uses it for proportional calculations: changing W auto-updates H = W/ratio, changing H auto-updates W = H*ratio. Uses stored ratio instead of current dimensions to avoid keystroke-by-keystroke compounding errors. Supports polygon (regenerates points) and line (scales both axes) nodes. Per-node state, works with undo/redo. Tested: lock toggle, W change updates H proportionally, H change updates W proportionally, unlock restores independent editing.

[2026-02-02] Fixed instance resize deformation. Component instances (RefNode) were wrapping children in a scaling <Group scaleX/scaleY> that stretched children proportionally when the instance was resized — unlike the main component (frame) which renders children at their original sizes. Removed the inner scaling Group from InstanceRenderer so children render directly (like FrameRenderer does). Added handleInstanceTransform live transform handler in RenderNode.tsx (mirrors handleFrameTransform) to update width/height during drag and reset scale. Added ref early-return case in handleTransformEnd. Passed onTransformStart/onTransform props to InstanceRenderer. Tested: instance resize no longer deforms children — they stay at original sizes just like in the main component.

[2026-02-02] Added line and polygon node types. Added LineNode (points: [x1,y1,x2,y2]) and PolygonNode (points: vertices[], sides) interfaces to scene.ts, updated SceneNode union. Added 'line' | 'polygon' to DrawToolType in drawModeStore.ts. Created LineRenderer.tsx (Konva Line, closed=false, hitStrokeWidth=10 for easy selection) and PolygonRenderer.tsx (Konva Line, closed=true, fill+gradient support). Added cases to RenderNode.tsx switch. Added node creation in useCanvasPointerHandlers.ts — line creates diagonal from drag start to end, polygon generates regular polygon points (default 6 sides) inscribed in bounding box. Added Line (L) and Polygon (P) tool buttons to PrimitivesPanel.tsx with LineSegmentIcon and HexagonIcon. Added KeyL/KeyP keyboard shortcuts in useCanvasKeyboardShortcuts.ts. Added layer icons in LayersPanel.tsx. Added Sides numeric input (3-12) in PropertyEditor.tsx that recalculates polygon vertices on change. Tested: line draws on canvas via drag, polygon draws as hexagon, sides change to triangle (3), fill/stroke/opacity work, drag/transform/selection/hover work, save/load persistence confirmed.

[2026-02-02] Implemented drag-and-drop image/SVG from OS file manager onto canvas. Created useCanvasFileDrop hook (src/components/canvas/useCanvasFileDrop.ts) with native DOM dragover/dragenter/dragleave/drop event listeners on canvas container. For image files (.png, .jpg, .gif, .webp): reads via FileReader.readAsDataURL, loads image to get natural dimensions, creates RectNode with imageFill capped at 800px max. For SVG files: reads via FileReader.readAsText, uses existing parseSvgToNodes from svgUtils.ts. Converts drop event client coordinates to canvas coordinates using viewport store (scale/offset). Multiple files offset by 20px each. Added visual drop overlay (dashed blue border + light blue background) via isDragOver state with dragEnterCount tracking. Integrated into Canvas.tsx. Tested: PNG drop creates image node at cursor, SVG drop creates path nodes at cursor, overlay appears on file drag, nodes are selectable/movable/transformable, multiple files handled correctly.

[2026-02-02] Implemented Google Fonts support. Added static catalog of ~250 popular Google Fonts to fontUtils.ts with loadGoogleFont() (injects <link> stylesheet tag, waits for document.fonts.ready) and loadGoogleFontsFromNodes() (recursively scans node tree for Google Font families). Updated getAvailableFonts() to merge system fonts + Google Fonts with deduplication. Updated FontCombobox.tsx: removed font preview styling (fontFamily on each item), added "G" badge for Google Fonts, calls loadGoogleFont on selection. Updated sceneStore.ts setNodes action to auto-load Google Fonts from opened files and re-sync text dimensions after fonts load. Tested: Google Fonts appear in dropdown with "G" badge, selecting Poppins loads font and renders on canvas, save/load persistence works with auto-loading, search/filter works, list opens instantly without preview lag.

[2026-02-02] Implemented collapsible Fill, Stroke and Effects sections in property panel.

[2026-02-02] Fixed group copy in multi-selection. The clipboard store only supported a single node (copiedNode: SceneNode | null) and the copy/cut handlers required exactly 1 selected node (ids.length === 1 guard). Changed clipboardStore to store copiedNodes: SceneNode[] array, updated copy handler to collect all selected nodes, updated cut handler to delete all selected nodes, updated paste handler to clone and add all copied nodes and multi-select them after paste. Tested: multi-select group+rect copy/paste works, pasted group preserves children, single-node copy/paste regression passes. FillSection now collapses to header + "+ Fill" button when node has no fill/gradientFill/imageFill; clicking "+" sets default fill #000000. StrokeSection collapses to header + "+ Stroke" when no stroke/strokeWidth; clicking "+" sets default #000000 stroke with weight 1. EffectsSection already had the collapsible pattern; updated to use consistent "−" button in the action area instead of inline "Remove" text. All three sections show a red "−" button next to the title when expanded, which removes the property and collapses the section. Tested: add/remove fill, add/remove stroke, add/remove shadow all work correctly.

[2026-02-02] Fixed spacing property calculation. Root cause: calculateSpacing() and distributeSpacing() in alignmentUtils.ts used node.width/node.height directly, but auto-layout frames with fit_content sizing have their actual dimensions computed by Yoga layout, not stored in node.width. Added getEffectiveDimensions() helper that calls calculateFrameIntrinsicSize() for fit_content frames. Updated all functions (gatherNodeInfos, getDominantAxis, calculateSpacing, distributeSpacing, alignNodes) to use effectiveWidth/effectiveHeight. Also clamped negative gaps to 0 in calculateSpacing, clamped newGap to >=0 in distributeSpacing, and clamped input to >=0 in SpacingInput handleApply. Tested: auto-layout fit_content frames show correct spacing, entering 0 makes objects flush, negative values clamped to 0, distribute spacing works correctly with auto-layout frames.

[2026-02-03] Implemented clip content feature for frames. Added clip?: boolean property to FrameNode in scene.ts. Added "Clip content" checkbox to SizeSection in PropertiesPanel (visible only for frame nodes). Implemented clipFunc on Konva Group in FrameRenderer.tsx that clips children to frame bounds — uses roundRect() when cornerRadius is set, falls back to rect() otherwise. Tested: checkbox toggles correctly, children extending beyond bounds are visually clipped when enabled, clipping follows rounded corners, save/load persistence works automatically via JSON serialization.

[2026-02-03] Fixed SVG clip-path import. Added clipGeometry and clipBounds fields to PathNode and GroupNode in scene.ts. Created collectClipPaths() function in svgUtils.ts to parse <clipPath> definitions from SVG <defs> — supports circle, rect, ellipse, and path elements with automatic conversion to SVG path data. Updated collectPaths() to detect clip-path="url(#id)" attributes and resolve references to clipPath definitions. Applied clipFunc in PathRenderer.tsx and GroupRenderer.tsx with proper coordinate transforms. Added fill-rule support (fillRule field in PathNode, parsing in svgUtils.ts, and fillRule prop on Konva Path) to render paths with cutouts (evenodd creates hollow shapes). Tested with logo-invert.svg: orange icon renders with hollow center, CALDERA text visible, save/load persistence confirmed.

[2026-02-03] Fixed group copy children offset bug. When copying a group/frame, children were incorrectly offset by +20px because cloneNodeWithNewId() applied the offset recursively to all nodes, including children which use relative coordinates. Added applyOffset parameter (defaults to true) to cloneNodeWithNewId() in src/utils/cloneNode.ts. When recursively cloning children of frames and groups, now passes false to prevent offset. Tested: created group with 2 rectangles, copied and pasted — children maintain their exact relative positions within the copied group (0,0 and 100,50 unchanged).

[2026-02-03] Implemented Shift+A keyboard shortcut to wrap selected elements in auto-layout frame. Added wrapNodesInAutoLayoutFrame helper function and wrapInAutoLayoutFrame action to sceneStore.ts that calculates bounding box of selected nodes, creates a FrameNode with auto-layout enabled (vertical direction, 0 gap/padding), and moves selected nodes as children with relative positions. Added Shift+A keyboard handler to useCanvasKeyboardShortcuts.ts. Passed action to Canvas.tsx. Tested: select multiple elements, press Shift+A — creates frame with auto-layout, elements become children, frame is selected.

[2026-02-04] Implemented alignment section for nodes inside frames. Added alignNodeInFrame() function to alignmentUtils.ts that aligns a single node relative to its parent frame/group boundaries (supports left, centerH, right, top, centerV, bottom). Modified AlignmentSection.tsx to accept optional parentFrame prop and handle single-node alignment mode (hides spacing input for single selections). Updated PropertiesPanel.tsx condition to show AlignmentSection when a single node is inside a non-auto-layout frame. Tested: alignment section appears for nodes inside regular frames, all 6 alignment types work correctly (positions update to frame-relative coordinates), alignment section does NOT appear for nodes inside auto-layout frames.

[2026-02-04] Implemented Shift+click range selection in Layers panel. Added lastSelectedId state and selectRange(fromId, toId, flatIds) method to selectionStore.ts. Updated select() and setSelectedIds() to track lastSelectedId. Modified handleClick in LayersPanel.tsx LayerItem component to call selectRange when Shift is held and there's a previous selection. Passed flatIds array through LayerList to LayerItem. Tested: click first layer then Shift+click third layer selects all 3 layers, reverse direction (click 5th then Shift+click 2nd) selects all 4 layers correctly.

[2026-02-05] Implemented Pixso v1 clipboard import via fig-kiwi marker rewrite. Pixso v1 format uses identical Kiwi binary data as Figma but with different HTML markers (pixsometa/pixso vs figmeta/figma). Added rewritePixsoMarkers() to transparently convert Pixso v1 markers to Figma markers before passing to fig-kiwi's readHTMLMessage(). Added unescapeClipboardHtml() to handle browser HTML entity escaping in clipboard data. Added undo/redo batching (saveHistory + startBatch/endBatch) for both internal and Pixso/Figma paste operations. Removed ~400 lines of broken debug code (parsePixsoKiwi hex dumps, parsePixsoV2Clipboard, readVarint/readString/readFloat32 helpers, fzstd import). Removed all console.log debug statements from paste handler. Tested: Pixso v1 format detection and parsing works, Figma format still works, browser-escaped HTML handled correctly, undo removes entire paste in one step, Pixso v2 format gracefully ignored (not in scope).

[2026-02-05] Fixed export scale bug where exported image dimensions depended on canvas zoom level. Root cause: Konva's node.toDataURL() includes the Stage's scaleX/scaleY transforms (used for viewport zoom) in the output, making exported images larger/smaller depending on zoom. Fix: added viewportScale parameter to ExportOptions in exportUtils.ts and divided pixelRatio by viewportScale to compensate (pixelRatio: scale / viewportScale). Updated ExportSection.tsx to read viewport scale from useViewportStore and pass it to exportImage(). Tested: 200×200 frame exports as 200×200 at 100%, 200%, 300%, 1000% zoom; 2x/3x multipliers produce correct 400×400 / 600×600 at all zoom levels.

[2026-02-05] Implemented Pixso JSON import. Created pixsoImportUtils.ts with convertPixsoNode() that maps all Pixso node types (FRAME, GROUP, COMPONENT, INSTANCE, SECTION, RECTANGLE, ELLIPSE, POLYGON, STAR, VECTOR, LINE, TEXT) to internal SceneNode types. Handles color conversion (0-1 floats to hex), fill/stroke extraction, auto-layout mapping (direction, gap, padding, alignment, sizing modes), text properties (font family/weight/style, alignment, line height, letter spacing, decorations), and corner radius. Added "Import JSON" button to Toolbar.tsx that opens a Dialog with textarea for pasting JSON. Supports both raw ExportedNode and ExportFrameJsonResult wrapper formats. Invalid JSON shows error message. Tested: simple frame with rect/ellipse children imports correctly, complex structure with auto-layout, text, stroke, nested frames all render correctly with proper positions, sizes, fills, and layout properties.

[2026-02-06] Implemented per-side stroke (top, right, bottom, left) like CSS border properties. Added PerSideStroke interface and strokeWidthPerSide property to BaseNode in scene.ts. Created PerSideStrokeLines component in renderUtils.tsx using 4 separate Konva Lines for per-side stroke rendering. Updated RectRenderer.tsx and FrameRenderer.tsx to conditionally use per-side strokes when strokeWidthPerSide is set. Added mode toggle (Unified/Per Side) in StrokeSection.tsx with 4 inputs (T, R, B, L) for per-side mode. Per-side mode is disabled for ellipses (doesn't make sense visually). Tested: mode switching, different values per side, visual rendering with Konva, save/load persistence confirmed.

[2026-02-09] Implemented dark theme interface. Created uiThemeStore.ts (Zustand store for UI theme with localStorage persistence and system preference fallback via prefers-color-scheme). Added theme toggle button (Moon/Sun icon) to bottom of RightSidebar. Store applies .dark class on document.documentElement during initialization (no flash). On toggle, also syncs page background between light (#f5f5f5) and dark (#1a1a1a) defaults. Fixed hardcoded bg-white in select.tsx and FontCombobox.tsx to use bg-surface-panel theme variable. Imported store in App.tsx for early initialization. Tested: toggle switches light/dark correctly, all panels re-theme, canvas background updates, theme persists across reload, falls back to system preference when localStorage cleared.

[2026-02-09] Fixed Pixso JSON SVG import (VECTOR nodes). VECTOR nodes were silently converted to plain rectangles, losing all vector geometry. Exported getPathBBox from svgUtils.ts. Extended PixsoNode interface with fillGeometry/strokeGeometry and added PixsoGeometry interface. Replaced VECTOR case in convertPixsoNode() to: parse fillGeometry array, compute bounding boxes via getPathBBox, create PathNode(s) with geometry, geometryBounds, fillRule, pathStroke; single path returns PathNode directly, multiple paths wrap in GroupNode, no geometry falls back to RectNode. Updated exportTypes_upd.ts with VectorGeometry type. Tested: star SVG imports as red PathNode, heart SVG with EVENODD renders correctly inside a frame, fallback VECTOR (no fillGeometry) creates rectangle, mixed frame with TEXT+RECT+VECTOR+ELLIPSE children all render correctly.

[2026-02-09] Fixed broken nested auto-layout sizing/positioning in copied component instances (both Konva and Pixi). Root cause: instance rendering only applied auto-layout at top-level component children, so nested auto-layout frames inside instance subtrees kept stale coordinates/sizes. Added recursive auto-layout application for instance descendant trees in Konva (InstanceRenderer.tsx) and Pixi (renderers.ts createRefContainer path). Also fixed clipboard clone of RefNode to deep-clone descendants/slotContent in cloneNode.ts to prevent shared-reference side effects between pasted instances. Tested: npm run build passes.

[2026-02-10] Fixed component-context size label behavior for selection overlays. In Konva, useCanvasSelectionData now detects component ancestry per selected node, supports descendant selection inside instance edit mode for size-label positioning, and propagates component-context flag to NodeSizeLabel (including group/multi-selection bbox). Extended NodeSizeLabel with forceComponentStyle to keep label color/context aligned with purple component transformer. In Pixi, SelectionOverlay now marks size labels as component-context when any selected node is inside a component/instance (not only single selection). Tested: npm run build passes.

[2026-02-11] Fixed Pixso JSON VECTOR import fallback for stroke-only geometry. Updated src/utils/pixsoImportUtils.ts: VECTOR conversion now uses fillGeometry first, and falls back to strokeGeometry when fillGeometry is absent. Added line-friendly bbox handling (skip only when both width and height are zero; keep 1px minimum visual size per axis), prevented applying fill/gradient when geometry source is strokeGeometry, and added explicit console warning when both geometry arrays are missing before fallback to rect. Tested: npm run build passes; file-level eslint for pixsoImportUtils passes.
